package vulnerability

import (
	"github.com/PaloAltoNetworks/pango/version"
)

type tc struct {
	desc    string
	version version.Number
	conf    Entry
}

func getTests() []tc {
	return []tc{
		{"v1 with desc", version.Number{6, 1, 0, ""}, Entry{
			Name:        "t2",
			Description: "foobar",
		}},
		{"v1 rule default", version.Number{6, 1, 0, ""}, Entry{
			Name:        "t2",
			Description: "foobar",
			Rules: []Rule{
				Rule{
					Name:          "first",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"critical", "high"},
					Category:      "dos",
					Action:        ActionDefault,
					PacketCapture: Disable,
				},
			},
		}},
		{"v1 rule allow", version.Number{6, 1, 0, ""}, Entry{
			Name: "blah",
			Rules: []Rule{
				Rule{
					Name:          "two",
					ThreatName:    "some threat",
					Cves:          []string{"cve1"},
					Host:          HostClient,
					VendorIds:     []string{"id1", "id2"},
					Severities:    []string{"informational"},
					Category:      "brute-force",
					Action:        ActionAllow,
					PacketCapture: SinglePacket,
				},
			},
		}},
		{"v1 rule alert", version.Number{6, 1, 0, ""}, Entry{
			Name: "blah",
			Rules: []Rule{
				Rule{
					Name:          "three",
					ThreatName:    "some threat",
					Cves:          []string{"cve1"},
					Host:          HostServer,
					VendorIds:     []string{"id3", "id1", "id2"},
					Severities:    []string{"any"},
					Category:      "exploit-kit",
					Action:        ActionAlert,
					PacketCapture: ExtendedCapture,
				},
			},
		}},
		{"v1 rule block", version.Number{6, 1, 0, ""}, Entry{
			Name: "blah",
			Rules: []Rule{
				Rule{
					Name:          "four",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"any"},
					Category:      "phishing",
					Action:        ActionBlock,
					PacketCapture: Disable,
				},
			},
		}},
		{"v1 exception default", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "first",
					PacketCapture: Disable,
					Action:        ActionDefault,
					TimeInterval:  42,
				},
			},
		}},
		{"v1 exception allow", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "two",
					PacketCapture: SinglePacket,
					Action:        ActionAllow,
					TimeThreshold: 512,
					ExemptIps:     []string{"192.168.55.44"},
				},
			},
		}},
		{"v1 exception alert", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "three",
					PacketCapture: ExtendedCapture,
					Action:        ActionAlert,
					TimeTrackBy:   TrackBySource,
				},
			},
		}},
		{"v1 exception drop", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionDrop,
					TimeInterval:  42,
					TimeThreshold: 1024,
					TimeTrackBy:   TrackByDestination,
				},
			},
		}},
		{"v1 exception drop all", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionDropAll,
				},
			},
		}},
		{"v1 exception reset client", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionResetClient,
				},
			},
		}},
		{"v1 exception reset server", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionResetServer,
				},
			},
		}},
		{"v1 exception reset both", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionResetBoth,
				},
			},
		}},
		{"v1 exception block ip", version.Number{6, 1, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:            "four",
					PacketCapture:   Disable,
					Action:          ActionBlockIp,
					BlockIpTrackBy:  TrackBySource,
					BlockIpDuration: 42,
				},
			},
		}},
		{"v2 rule default", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "first",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"critical", "high"},
					Category:      "dos",
					Action:        ActionDefault,
					PacketCapture: Disable,
				},
			},
		}},
		{"v2 rule allow", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "two",
					ThreatName:    "some threat",
					Cves:          []string{"cve1"},
					Host:          HostClient,
					VendorIds:     []string{"id1", "id2"},
					Severities:    []string{"informational"},
					Category:      "brute-force",
					Action:        ActionAllow,
					PacketCapture: SinglePacket,
				},
			},
		}},
		{"v2 rule alert", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "three",
					ThreatName:    "some threat",
					Cves:          []string{"cve1"},
					Host:          HostServer,
					VendorIds:     []string{"id3", "id1", "id2"},
					Severities:    []string{"any"},
					Category:      "exploit-kit",
					Action:        ActionAlert,
					PacketCapture: ExtendedCapture,
				},
			},
		}},
		{"v2 rule drop", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "four",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"any"},
					Category:      "phishing",
					Action:        ActionDrop,
					PacketCapture: Disable,
				},
			},
		}},
		{"v2 rule reset client", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "four",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"any"},
					Category:      "phishing",
					Action:        ActionResetClient,
					PacketCapture: Disable,
				},
			},
		}},
		{"v2 rule reset server", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "four",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"any"},
					Category:      "phishing",
					Action:        ActionResetServer,
					PacketCapture: Disable,
				},
			},
		}},
		{"v2 rule reset both", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:          "four",
					ThreatName:    "some threat",
					Cves:          []string{"cve1", "cve2"},
					Host:          HostAny,
					VendorIds:     []string{"any"},
					Severities:    []string{"any"},
					Category:      "phishing",
					Action:        ActionResetBoth,
					PacketCapture: Disable,
				},
			},
		}},
		{"v2 rule block ip", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Rules: []Rule{
				Rule{
					Name:            "four",
					ThreatName:      "some threat",
					Cves:            []string{"cve1", "cve2"},
					Host:            HostAny,
					VendorIds:       []string{"any"},
					Severities:      []string{"any"},
					Category:        "phishing",
					Action:          ActionBlockIp,
					BlockIpTrackBy:  TrackBySource,
					BlockIpDuration: 42,
					PacketCapture:   Disable,
				},
			},
		}},
		{"v2 exception default", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "first",
					PacketCapture: Disable,
					Action:        ActionDefault,
					TimeInterval:  42,
				},
			},
		}},
		{"v2 exception allow", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "two",
					PacketCapture: SinglePacket,
					Action:        ActionAllow,
					TimeThreshold: 512,
					ExemptIps:     []string{"192.168.55.44"},
				},
			},
		}},
		{"v2 exception alert", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "three",
					PacketCapture: ExtendedCapture,
					Action:        ActionAlert,
					TimeTrackBy:   TrackBySource,
				},
			},
		}},
		{"v2 exception drop", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionDrop,
					TimeInterval:  42,
					TimeThreshold: 1024,
					TimeTrackBy:   TrackByDestination,
				},
			},
		}},
		{"v2 exception reset client", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionResetClient,
				},
			},
		}},
		{"v2 exception reset server", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionResetServer,
				},
			},
		}},
		{"v2 exception reset both", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:          "four",
					PacketCapture: Disable,
					Action:        ActionResetBoth,
				},
			},
		}},
		{"v2 exception block ip", version.Number{7, 0, 0, ""}, Entry{
			Name: "foo",
			Exceptions: []Exception{
				Exception{
					Name:            "four",
					PacketCapture:   Disable,
					Action:          ActionBlockIp,
					BlockIpTrackBy:  TrackBySource,
					BlockIpDuration: 42,
				},
			},
		}},
	}
}
